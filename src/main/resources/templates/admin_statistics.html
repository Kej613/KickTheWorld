<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ICON -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
    <!-- ADMIN CSS -->
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <!--HEADER, FOOTER CSS-->
    <!-- <link rel="stylesheet" href="headerFooter.css">  -->
    <title>admin page</title>
    <script src="/js/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!--- SIDE BAR -->
<div class="side-bar">
    <div class="logo-name">
        <h2 style="color: white"> 안녕하세요, 관리자님! </h2>
    </div>
    <ul>
        <li><i class="ri-dashboard-line" style="font-size: 1.5rem;"></i><a th:href="@{/admin}"> &nbsp 대시보드</a></li>
        <li><i class="ri-money-dollar-circle-line" style="font-size: 1.5rem;"></i><a th:href="@{/adminlist}"> &nbsp 예약/결제 내역</a></li>
        <li><i class="ri-funds-box-line" style="font-size: 1.5rem;"></i><a th:href="@{/admin/statistics}"> &nbsp 통계</a></li>
        <li><i class="ri-settings-4-line" style="font-size: 1.5rem;"></i><a th:href="@{/notready}"> &nbsp 설정</a></li>
    </ul>
</div>

<!-- HEADER -->
<div class="container">
    <div class="header" style="width: 82vw;">
        <div class="nav">
            <a th:href="@{/}" style="font-size: 1.5rem;"><i class="ri-earth-line"></i> Kick The World </a>
            <ul>
                <li><a th:href="@{/main/trips}"><i class="ri-map-pin-line" style="font-size: 1.5rem;"></i>여행지</a></li>
                <li><a th:href="@{/main/stays}"><i class="ri-hotel-bed-line" style="font-size: 1.5rem;"></i>숙소</a></li>
                <li><a th:href="@{/main/eaterys}"><i class="ri-restaurant-line" style="font-size: 1.5rem;"></i>맛집</a></li>
                <li><a th:href="@{/search}"><i class="ri-heart-3-line" style="font-size: 1.5rem;"></i>추천코스</a></li>
                <li><a th:href="@{/board/list}"><i class="ri-edit-line" style="font-size: 1.5rem;"></i>여행게시판</a></li>
            </ul>
            <a th:href="@{/members/logout}" th:if="${#authorization.expression('isAuthenticated()')}">
                <span th:text="'[' + ${#authentication.principal.username} + ']' + '님 환영합니다! '"></span>&nbsp<b><span style="color: #6610f2;">로그아웃</span></b></a>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="content" style="margin-top:100px; text-align:center; ">

            <h2>숙소별 매출통계</h2><br><br>
        <div style="width:70%; margin-left:auto; margin-right:auto;">
            <canvas id="salesChart" width="300" height="150"></canvas></div>


    </div>
</div>
<script th:inline="javascript">

    // pay 데이터를 순회하면서 숙소별 판매금액 집계
    var payData = [
        ["1", "PAR20231213000165657", "CANCEL_20231213173803851M_user1", "0", "", "STFP_PNPTM226603700231214163447M1723395", "M2266037", "2023-12-27", "2023-12-28", "20231213173803851M_user1", "0", "", "C", "서귀포 블랑블루펜션", "0cc763d46f439791358c330a1efb9c72eb415fd2ab2b2d4fb04d7dc6de249ab6", "20231213", "STFP_PNPTM226603700231213173838M1075234", "100000", "173809", "self"],
        ["2", "", "", "","", "", "M2266037" , "2023-12-27", "2023-12-28", "20231213181555152M_user1", "","","0","서귀포 블랑블루펜션", "10e96cb73b670c4123abfdf0fd3755099b3fdf9f6df9d51b5995453468d02dd3", "20231213", "", "100000", "181725","self"],
        ["3", "", "", "", "", "", "M2266037", "2023-12-16", "2023-12-23", "20231215153446461M_user1", "", "", "O", "모항레저타운", "0223a48a1062baf4f78b4b9bc10f6916d1e102183fb812d42930539013c4189c", "20231215", "", "1750000", "153524", "self"],
        ["4", "", "", "", "", "", "M2266037", "2023-12-20", "2023-12-21", "20231216013241153M_user1", "", "", "O", "전주한옥마을숙박 다락", "b3b41636e4c647b69ff175c8adaf0cf9d87e0016e1e02b7b0d5f908031f32e65", "20231216", "", "56000", "013243", "self"],
        ["5", "PAR20231216000166171", "", "", "", "", "M2266037", "2023-12-20", "2023-12-21", "20231216013329178M_user1", "0", "", "P", "전주한옥마을숙박 다락", "f51dd602f61903335ccced4df5036b305f3c511ab096b96c82e545bab6197593", "20231216", "STFP_PNPTM226603700231216013442M1880770", "56000", "013334", "self"],
        ["6", "", "", "", "", "", "M2266037", "2023-12-19", "2023-12-21", "20231216191012961M_dmswjd0613", "", "", "O", "낯선하루", "f16aca1e897520368cbd9ed95bc3b3c5b46b0c05e72c93aba209a6de356419a0", "20231216", "", "56000", "191019", "self"],
        ["7", "PAR20231216000166173", "CANCEL_20231216192744939M_dmswjd0613", "0", "", "STFP_PNPTM226603700231216195247M1447251", "M2266037", "2023-12-19", "2023-12-21", "20231216192744939M_dmswjd0613", "0", "", "C", "낯선하루", "94ad782b364f57bf64a5ca4b5000675f044347da1a89d49f831be0f7418f205e", "20231216", "STFP_PNPTM226603700231216193407M1818541", "56000", "192752", "self"]

    ];

    // 숙소별 판매금액을 저장할 객체
    var salesByAccommodation = {};

    // pay 데이터를 순회하면서 숙소별 판매금액 집계
    for (var i = 0; i < payData.length; i++) {
        var row = payData[i];
        var accommodationName = row[13]; // 숙소명은 15번째 열에 위치
        var salesAmount = parseInt(row[17]); // 숙소금액은 17번째 열에 위치

        // 숙소명이 이미 salesByAccommodation 객체에 있다면 더하고, 없다면 새로 추가
        if (salesByAccommodation[accommodationName]) {
            salesByAccommodation[accommodationName] += salesAmount;
        } else {
            salesByAccommodation[accommodationName] = salesAmount;
        }
    }

    // salesByAccommodation 객체를 배열로 변환
    var salesData = Object.values(salesByAccommodation);
    var accommodationNames = Object.keys(salesByAccommodation);

    // 차트를 그릴 canvas 요소 가져오기
    var ctx = document.getElementById('salesChart').getContext('2d');

    // 차트 생성
    var myChart = new Chart(ctx, {
        type: 'bar', // 막대 그래프
        data: {
            labels: accommodationNames,
            datasets: [{
                label: '숙소별 매출',
                data: salesData,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

</script>

</body>
</html>